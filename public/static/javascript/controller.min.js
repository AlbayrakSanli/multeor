var socket=io.connect(window.location.hostname+":843");
$(document).ready(function(){$(window).width();$(window).height();var k=sessionStorage.getItem("player-id")||Math.floor(1E4*Math.random()+1E4),q=0,r=0,b=1,g=!1,l=0,m="",d=!0;sessionStorage.setItem("player-id",k);var n=parseInt(sessionStorage.getItem("game-room"),10);socket.emit("verify-game-room",{gameRoom:n});socket.on("disconnect",function(){document.location="/"});socket.on("game-invalid",function(a){sessionStorage.setItem("player-id","");sessionStorage.setItem("game-room","");document.location=
"/"});socket.on("game-has-started",function(a){$("#score").html("Sorry, game already started")});socket.on("game-full",function(a){$("#score").html("Too many players")});socket.on("player-joined",function(a){g=!0;s();$("#score").html("Waiting for other players")});socket.on("game-reset",function(a){document.location.reload()});socket.on("game-get-ready",function(a){Upon.log("game-get-ready");$("#score").html("Get ready")});socket.on("game-start",function(a){Upon.log("game-start");$("#score").html(0)});
socket.on("game-end",function(a){Upon.log("game-end");$("#score").html(l);g=!1});socket.on("update-score",function(a){Upon.log("update-score");$("html,body").css({backgroundColor:"#FFF"});setTimeout(function(){$("html,body").css({backgroundColor:"rgba("+m+",.8)"})},250);l=a.score;$("#score").html(l)});socket.on("update-player-color",function(a){m=a.playerColor;$("html, body").css({backgroundColor:"rgba("+m+",.8)"})});var p=0,t=new Date;setInterval(function(){var a=new Date,h=a-t;1E3<h&&(t=a,a=Math.round(p/
(h/1E3),2),$("#message").html(a+" average PPS"),p=0)},500);g=!1;socket.emit("new-player",{playerId:k,gameRoom:n});var s=function(){if(!g)return!1;d&&(socket.emit("player-update",{pid:k,gr:n,v:[Math.floor(q),Math.floor(r),b]}),p++,d=!1);setTimeout(s,20)},u=function(a,h){var c,f;c=$("#leftControls").width()/3;var e=0,e=h-c,b=a-c;f=Math.sqrt(Math.pow(e,2)+Math.pow(b,2));e=180*Math.asin(e/f)/Math.PI;0>b&&(e=180-e);f>c&&(f=c);q=c=e;r=f;$("#joystick").width(f).css({"-webkit-transform":"rotate("+c+"deg)",
"-ms-transform":"rotate("+c+"deg)"});d=!0};window.navigator.msPointerEnabled?($("#leftControls").on("MSPointerMove",function(a){a.preventDefault();var b=a.originalEvent.clientX.toFixed(0)-$(this).offset().left;a=a.originalEvent.clientY.toFixed(0)-$(this).offset().top;u(b,a)}),$("#leftControls").on("MSPointerUp",function(a){$("#joystick").animate({width:5},400)}),$("#rightControls #button").on("MSPointerDown",function(a){a.preventDefault();b=3;d=!0;$(this).toggleClass("pressed")}),$("#rightControls #button").on("MSPointerUp",
function(a){a.preventDefault();b=1;d=!0;$(this).toggleClass("pressed")})):($("#leftControls").on("touchmove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches[0].clientX-$(this).offset().left;a=a.originalEvent.targetTouches[0].clientY-$(this).offset().top;u(b,a)}),$("#leftControls").on("touchend",function(a){$("#joystick").animate({width:5},400)}),$("#rightControls #button").on("touchstart",function(a){a.preventDefault();b=3;d=!0;$(this).toggleClass("pressed")}),$("#rightControls #button").on("touchend",
function(a){a.preventDefault();b=1;d=!0;$(this).toggleClass("pressed")}))});
