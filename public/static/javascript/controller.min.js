var socket=io.connect(window.location.hostname+":3333");
$(document).ready(function(){$(window).width();$(window).height();var b=sessionStorage.getItem("player-id")||Math.floor(1E4*Math.random()+1E4),d=0,e=0,c=1,g=!1,h=0,k="",f=!0;sessionStorage.setItem("player-id",b);var l=parseInt(sessionStorage.getItem("game-room"),10);socket.emit("verify-game-room",{gameRoom:l});var m=function(){g=!1;$("#score").html("Click to join game");$("body").on("click touchstart",function(){$("body").off("click touchstart");socket.emit("new-player",{playerId:b,gameRoom:l})})};
m();socket.on("disconnect",function(){document.location="/"});socket.on("game-invalid",function(a){sessionStorage.setItem("player-id","");sessionStorage.setItem("game-room","");document.location="/"});socket.on("game-has-started",function(a){$("#score").html("Sorry, game already started")});socket.on("game-full",function(a){$("#score").html("Too many players")});socket.on("player-joined",function(a){g=!0;n();$("#score").html("Waiting for other players")});socket.on("game-reset",function(a){m()});
socket.on("game-get-ready",function(a){Upon.log("game-get-ready");$("#score").html("Get ready")});socket.on("game-start",function(a){Upon.log("game-start");$("#score").html(0)});socket.on("game-end",function(a){Upon.log("game-end");$("#score").html(h);g=!1});socket.on("update-score",function(a){Upon.log("update-score");$("html,body").css({backgroundColor:"#FFF"});setTimeout(function(){$("html,body").css({backgroundColor:"rgba("+k+",.8)"})},250);h=a.score;$("#score").html(h)});socket.on("update-player-color",
function(a){k=a.playerColor;$("html, body").css({backgroundColor:"rgba("+k+",.8)"})});var n=function(){if(!g)return!1;f&&(socket.emit("player-update",{pid:b,gr:l,v:[Math.floor(d),Math.floor(e),c]}),f=!1);setTimeout(n,40)},p=function(a,c){var b=$("#leftControls").width()/3,b=toDegrees(a,c,b);d=b.deg;e=b.length;$("#joystick").width(b.length).css({"-webkit-transform":"rotate("+b.deg+"deg)","-ms-transform":"rotate("+b.deg+"deg)"});f=!0};window.navigator.msPointerEnabled?($("#leftControls").on("MSPointerMove",
function(a){a.preventDefault();var b=a.originalEvent.clientX.toFixed(0)-$(this).offset().left;a=a.originalEvent.clientY.toFixed(0)-$(this).offset().top;p(b,a)}),$("#leftControls").on("MSPointerUp",function(a){$("#joystick").animate({width:5},400)}),$("#rightControls #button").on("MSPointerDown",function(a){a.preventDefault();c=3;f=!0;$(this).toggleClass("pressed")}),$("#rightControls #button").on("MSPointerUp",function(a){a.preventDefault();c=1;f=!0;$(this).toggleClass("pressed")})):($("#leftControls").on("touchmove",
function(a){a.preventDefault();var b=a.originalEvent.targetTouches[0].clientX-$(this).offset().left;a=a.originalEvent.targetTouches[0].clientY-$(this).offset().top;p(b,a)}),$("#leftControls").on("touchend",function(a){$("#joystick").animate({width:5},400)}),$("#rightControls #button").on("touchstart",function(a){a.preventDefault();c=3;f=!0;$(this).toggleClass("pressed")}),$("#rightControls #button").on("touchend",function(a){a.preventDefault();c=1;f=!0;$(this).toggleClass("pressed")}))});
function toDegrees(b,d,e){var c=0,c=d-e;b-=e;d=Math.sqrt(Math.pow(c,2)+Math.pow(b,2));c=180*Math.asin(c/d)/Math.PI;0>b&&(c=180-c);d>e&&(d=e);return{deg:c,length:d}};
