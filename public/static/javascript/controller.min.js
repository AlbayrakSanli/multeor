var socket=io.connect(window.location.hostname+":3333");
$(document).ready(function(){$(window).width();$(window).height();var c=sessionStorage.getItem("player-id")||Math.floor(1E4*Math.random()+1E4),d=0,e=0,b=0,f=!1,g=0,h="";sessionStorage.setItem("player-id",c);var k=parseInt(sessionStorage.getItem("game-room"),10);socket.emit("verify-game-room",{gameRoom:k});var l=function(){f=!1;$("#score").html("Click to join game");$("body").on("click touchstart",function(){$("body").off("click touchstart");socket.emit("new-player",{playerId:c,gameRoom:k})})};l();
socket.on("disconnect",function(){document.location="/"});socket.on("game-invalid",function(a){sessionStorage.setItem("player-id","");sessionStorage.setItem("game-room","");document.location="/"});socket.on("game-has-started",function(a){$("#score").html("Sorry, game already started")});socket.on("game-full",function(a){$("#score").html("Too many players")});socket.on("player-joined",function(a){f=!0;m();$("#score").html("Waiting for other players")});socket.on("game-reset",function(a){l()});socket.on("game-get-ready",
function(a){console.log("game-get-ready");$("#score").html("Get ready")});socket.on("game-start",function(a){console.log("game-start");$("#score").html(0)});socket.on("game-end",function(a){console.log("game-end");$("#score").html(g);f=!1});socket.on("update-score",function(a){console.log("update-score");$(window).trigger("audio-destroy");$("html,body").css({backgroundColor:"#FFF"});setTimeout(function(){$("html,body").css({backgroundColor:h})},250);g=a.score;$("#score").html(g)});socket.on("update-player-color",
function(a){h=a.playerColor;$("html, body").css({backgroundColor:h})});var m=function(){if(!f)return!1;socket.emit("player-update",{pid:c,gr:k,v:[Math.floor(d),Math.floor(e),b]});setTimeout(m,40)};$("#leftControls").on("touchmove",function(a){a.preventDefault();var b=$(this).width()/3,c=a.originalEvent.targetTouches[0].clientX-$(this).offset().left;a=a.originalEvent.targetTouches[0].clientY-$(this).offset().top;b=toDegrees(c,a,b);d=b.deg;e=b.length;$("#joystick").width(b.length).css("-webkit-transform",
"rotate("+b.deg+"deg)")});$("#leftControls").on("touchend",function(a){$("#joystick").animate({width:5},400)});$("#rightControls").on("touchmove",function(a){a.preventDefault();a=a.originalEvent.targetTouches[0].clientY-$(this).offset().top;22>a&&(a=22);128<a&&(a=128);b=a;$("#slider").css("top",b+"px")})});function toDegrees(c,d,e){var b=0,b=d-e;c-=e;d=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));b=180*Math.asin(b/d)/Math.PI;0>c&&(b=180-b);d>e&&(d=e);return{deg:b,length:d}};
